<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <link rel="stylesheet" th:href="styles.css" />

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Make a Payment Page</title>
</head>
<body class="main-body">
<h1>Citi Credit Card Manager</h1>
<nav>
    <ul>
        <li><a href="http://localhost:8080/homepage">Home</a></li>
        <li><a href="http://localhost:8080/statements">Statements Summary</a></li>
        <li><a href="http://localhost:8080/transactions">All Transactions</a></li>
        <li id="sign-out-button"><a href="http://localhost:8080/login">Sign Out</a></li>
    </ul>
</nav>
<div id="home" class="page">
    <h1>Make a Payment</h1>
    <form id="paymentForm">
        <label for="phoneNumber">Account Holder Phone Number:</label>
        <input type="text" id="phoneNumber" name="phoneNumber" required><br><br>

        <label for="cardId">Select Card:</label>
        <select id="cardId" name="cardId" required>
            <!-- Options will be populated by JavaScript -->
        </select><br><br>

        <label for="amount">Amount:</label>
        <input type="number" id="amount" name="amount" step="0.01" required><br><br>

        <button type="button" onclick="makePayment()">Make Payment</button>
    </form>

</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const phoneNumberInput = document.getElementById('phoneNumber');
        phoneNumberInput.addEventListener('change', loadCards);
    });

    async function loadCards() {
        const phoneNumber = document.getElementById('phoneNumber').value;
        const response = await fetch(`/api/account-holders/${phoneNumber}/cards`);
        const cards = await response.json();

        const cardSelect = document.getElementById('cardId');
        cardSelect.innerHTML = ''; // Clear previous options

        cards.forEach(card => {
            const option = document.createElement('option');
            option.value = card.cardNumber;
            option.textContent = `${card.cardName} - ${card.cardNumber}`;
            cardSelect.appendChild(option);
        });
    }

    async function makePayment() {
        const form = document.getElementById('paymentForm');
        const formData = new FormData(form);

        const paymentData = {
            amount: formData.get('amount'),
            accountHolderPhoneNumber: formData.get('phoneNumber'),
            cardNumber: formData.get('cardId')
        };

        const response = await fetch('/api/account-holders/transactions', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(paymentData)
        });

        if (response.ok) {
            alert('Payment Successful!');
        } else {
            alert('Payment Failed');
        }
    }
</script>
</body>
<script type="text/javascript" th:src="main.js"></script>
</html>